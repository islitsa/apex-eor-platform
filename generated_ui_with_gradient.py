
import gradio as gr
from typing import Dict, List

# Import M3 theme
from src.templates.m3_theme import get_m3_theme_css

# Pipeline data structure
PIPELINE_DATA = {'sources': {'fracfocus': {'name': 'fracfocus', 'display_name': 'Fracfocus', 'type': 'source_of_record', 'status': 'active', 'datasets': {'Chemical_data': {'name': 'Chemical_data', 'display_name': 'Chemical Data', 'status': 'ready', 'pipeline_stages': {'parsed': {'path': 'parsed/', 'status': 'complete', 'format': 'csv', 'total_files': 16, 'total_rows': 7255562, 'total_size_bytes': 3369356976, 'total_size_human': '3.14 GB', 'files': [{'file': 'DisclosureList_1.csv', 'rows': 239061, 'size_bytes': 58423194, 'format': 'csv'}, {'file': 'FracFocusRegistry_1.csv', 'rows': 503145, 'size_bytes': 234667706, 'format': 'csv'}, {'file': 'FracFocusRegistry_10.csv', 'rows': 501729, 'size_bytes': 236644378, 'format': 'csv'}, {'file': 'FracFocusRegistry_11.csv', 'rows': 501848, 'size_bytes': 235826948, 'format': 'csv'}, {'file': 'FracFocusRegistry_12.csv', 'rows': 501751, 'size_bytes': 235373483, 'format': 'csv'}, {'file': 'FracFocusRegistry_13.csv', 'rows': 502063, 'size_bytes': 235134876, 'format': 'csv'}, {'file': 'FracFocusRegistry_14.csv', 'rows': 455356, 'size_bytes': 213078113, 'format': 'csv'}, {'file': 'FracFocusRegistry_2.csv', 'rows': 502840, 'size_bytes': 239463135, 'format': 'csv'}, {'file': 'FracFocusRegistry_3.csv', 'rows': 507064, 'size_bytes': 239493893, 'format': 'csv'}, {'file': 'FracFocusRegistry_4.csv', 'rows': 508918, 'size_bytes': 242487015, 'format': 'csv'}, {'file': 'FracFocusRegistry_5.csv', 'rows': 508053, 'size_bytes': 245344836, 'format': 'csv'}, {'file': 'FracFocusRegistry_6.csv', 'rows': 503264, 'size_bytes': 243489637, 'format': 'csv'}, {'file': 'FracFocusRegistry_7.csv', 'rows': 501504, 'size_bytes': 235480493, 'format': 'csv'}, {'file': 'FracFocusRegistry_8.csv', 'rows': 501501, 'size_bytes': 235415316, 'format': 'csv'}, {'file': 'FracFocusRegistry_9.csv', 'rows': 501410, 'size_bytes': 235899091, 'format': 'csv'}, {'file': 'WaterSource_1.csv', 'rows': 16055, 'size_bytes': 3134862, 'format': 'csv'}], 'last_updated': '2025-10-25T14:30:44.685022'}, 'downloads': {'status': 'complete', 'path': 'C:\\Users\\irina\\apex-eor-platform\\data\\raw\\fracfocus\\Chemical_data\\downloads', 'timestamp': '2025-10-24T10:16:23.929854', 'files': 2, 'size_bytes': 432868901, 'size_human': '412.82 MB'}, 'extracted': {'status': 'complete', 'path': 'C:\\Users\\irina\\apex-eor-platform\\data\\raw\\fracfocus\\Chemical_data\\extracted', 'timestamp': '2025-10-24T11:18:24.746618', 'files': 17, 'size_bytes': 3369364579, 'size_human': '3.14 GB'}}, 'metadata': {'dataset': 'fracfocus', 'description': 'FracFocus Chemical Disclosure Registry - hydraulic fracturing chemical usage and water source data', 'source': {'url': 'https://fracfocus.org/', 'provider': 'FracFocus Chemical Disclosure Registry', 'license': 'Public Domain', 'update_frequency': 'Quarterly'}, 'provenance': {'download_timestamp': '2025-10-20T13:39:00', 'downloaded_by': 'automated_script', 'download_method': 'FracFocus bulk data download'}, 'files': {'downloads': {'path': 'downloads/', 'files': {'documentation': {'filename': 'fracfocus.pdf', 'description': 'FracFocus data dictionary and field definitions', 'size_mb': 8.0}}}, 'parsed': {'path': 'parsed/', 'format': 'CSV', 'delimiter': ',', 'encoding': 'UTF-8', 'total_files': 17, 'total_size_bytes': 3368997581, 'total_size_human': '3.1GB', 'total_records': 7255578}}, 'processing_state': {'download': 'complete', 'extraction': 'complete', 'parsing': 'complete', 'parsing_note': 'CSV files already in final format from source', 'validation': 'not_started', 'loading': 'not_started', 'extraction_date': '2025-10-24T11:18:24.767450', 'parsing_date': '2025-10-25T14:30:44.685022', 'parsed_files': 16}, 'tables': {'FracFocusRegistry': {'files': ['FracFocusRegistry_1.csv through FracFocusRegistry_14.csv'], 'description': 'Chemical ingredient disclosures for hydraulic fracturing operations', 'total_records': '~7M records (split across 14 files)', 'primary_key': ['API_NO', 'FRACTURE_DATE', 'INGREDIENT_NAME'], 'key_fields': ['API_NO', 'OPERATOR_NAME', 'WELL_NAME', 'FRACTURE_DATE', 'STATE', 'COUNTY', 'LATITUDE', 'LONGITUDE', 'TRADE_NAME', 'SUPPLIER', 'PURPOSE', 'INGREDIENT_NAME', 'CAS_NUMBER', 'PERCENT_HIGH_ADDITIVE', 'PERCENT_WEIGHT', 'HF_FLUID_CONCENTRATION'], 'critical_for_eor': True, 'linkage': 'Links to RRC data via API_NO'}, 'DisclosureList': {'file': 'DisclosureList_1.csv', 'description': 'Well-level disclosure metadata and job information', 'records': '~200K records', 'primary_key': ['API_NO', 'FRACTURE_DATE'], 'key_fields': ['API_NO', 'OPERATOR_NAME', 'WELL_NAME', 'FRACTURE_DATE', 'STATE', 'COUNTY', 'LATITUDE', 'LONGITUDE', 'PRODUCTION_TYPE', 'HORIZONTAL_VERTICAL', 'TRUE_VERTICAL_DEPTH', 'TOTAL_WATER_VOLUME'], 'critical_for_eor': True, 'linkage': 'Links to RRC data via API_NO'}, 'WaterSource': {'file': 'WaterSource_1.csv', 'description': 'Water source information for hydraulic fracturing operations', 'records': '~100K records', 'primary_key': ['API_NO', 'FRACTURE_DATE', 'WATER_SOURCE'], 'key_fields': ['API_NO', 'FRACTURE_DATE', 'WATER_SOURCE', 'WATER_VOLUME'], 'critical_for_eor': False, 'linkage': 'Links to DisclosureList and RRC via API_NO'}}, 'data_quality': {'completeness': 'good', 'validation_date': None, 'known_issues': ['Some API numbers may not match RRC format exactly (need normalization)', 'Chemical disclosure is voluntary - not all wells reported', 'Trade secret claims may hide some ingredient names']}, 'related_datasets': ['../rrc/completions_data - Links via API_NO for completion technique analysis', '../rrc/production - Links via API_NO to correlate frac design with production', '../rrc/horizontal_drilling_permits - Links via API_NO for permit-to-frac timeline'], 'eor_analysis_notes': ['Analyze chemical composition patterns in high-performing vs low-performing wells', 'Correlate specific additives (friction reducers, biocides, etc.) with EUR', 'Identify completion technique evolution over time', 'Link frac fluid volume and chemistry to production decline curves', 'Screen for wells with similar frac designs for EOR pilot candidates'], 'key_analyses': {'completion_techniques': {'description': 'Analyze frac fluid composition and volumes', 'fields': ['TRADE_NAME', 'PURPOSE', 'PERCENT_HIGH_ADDITIVE', 'TOTAL_WATER_VOLUME'], 'linkage': 'Join with RRC production via API_NO'}, 'chemical_trends': {'description': 'Track evolution of frac chemical usage over time', 'fields': ['FRACTURE_DATE', 'INGREDIENT_NAME', 'CAS_NUMBER'], 'applications': 'Identify modern vs legacy completion techniques'}, 'eor_screening': {'description': 'Find wells with similar completion chemistry for EOR pilots', 'fields': ['API_NO', 'INGREDIENT_NAME', 'PERCENT_HIGH_ADDITIVE'], 'linkage': 'Join with production decline analysis'}}, 'parsed': {'path': 'parsed/', 'status': 'complete', 'format': 'csv', 'total_files': 16, 'total_rows': 7255562, 'total_size_bytes': 3369356976, 'total_size_human': '3.14 GB', 'files': [{'file': 'DisclosureList_1.csv', 'rows': 239061, 'size_bytes': 58423194, 'format': 'csv'}, {'file': 'FracFocusRegistry_1.csv', 'rows': 503145, 'size_bytes': 234667706, 'format': 'csv'}, {'file': 'FracFocusRegistry_10.csv', 'rows': 501729, 'size_bytes': 236644378, 'format': 'csv'}, {'file': 'FracFocusRegistry_11.csv', 'rows': 501848, 'size_bytes': 235826948, 'format': 'csv'}, {'file': 'FracFocusRegistry_12.csv', 'rows': 501751, 'size_bytes': 235373483, 'format': 'csv'}, {'file': 'FracFocusRegistry_13.csv', 'rows': 502063, 'size_bytes': 235134876, 'format': 'csv'}, {'file': 'FracFocusRegistry_14.csv', 'rows': 455356, 'size_bytes': 213078113, 'format': 'csv'}, {'file': 'FracFocusRegistry_2.csv', 'rows': 502840, 'size_bytes': 239463135, 'format': 'csv'}, {'file': 'FracFocusRegistry_3.csv', 'rows': 507064, 'size_bytes': 239493893, 'format': 'csv'}, {'file': 'FracFocusRegistry_4.csv', 'rows': 508918, 'size_bytes': 242487015, 'format': 'csv'}, {'file': 'FracFocusRegistry_5.csv', 'rows': 508053, 'size_bytes': 245344836, 'format': 'csv'}, {'file': 'FracFocusRegistry_6.csv', 'rows': 503264, 'size_bytes': 243489637, 'format': 'csv'}, {'file': 'FracFocusRegistry_7.csv', 'rows': 501504, 'size_bytes': 235480493, 'format': 'csv'}, {'file': 'FracFocusRegistry_8.csv', 'rows': 501501, 'size_bytes': 235415316, 'format': 'csv'}, {'file': 'FracFocusRegistry_9.csv', 'rows': 501410, 'size_bytes': 235899091, 'format': 'csv'}, {'file': 'WaterSource_1.csv', 'rows': 16055, 'size_bytes': 3134862, 'format': 'csv'}], 'last_updated': '2025-10-25T14:30:44.685022'}}, 'actions_available': ['view_metadata', 'view', 'download', 're-run'], 'metadata_file': 'C:\\Users\\irina\\apex-eor-platform\\data\\raw\\fracfocus\\Chemical_data\\metadata.json'}}, 'pipeline_stages_used': ['downloads', 'extracted', 'parsed'], 'processing_notes': {'parsing_note': 'CSV files already in final format from source'}, 'metadata': {'last_download': {'dataset': 'fracfocus', 'download_date': '2025-10-31T07:34:57.364341', 'source_url': 'https://fracfocusdata.org/DigitalDownload/FracFocusCSV.zip', 'file_path': 'data\\raw\\fracfocus\\downloads\\FracFocusCSV.zip', 'file_size': 1322, 'md5_checksum': '86d50472062e624040aefa30452e5627', 'status': 'downloaded', 'license': 'Public Domain', 'update_frequency': 'Quarterly'}, 'processing_state': {'download': 'complete'}}}, 'NETL EDX': {'name': 'NETL EDX', 'display_name': 'Netl Edx', 'type': 'source_of_record', 'status': 'active', 'datasets': {}, 'pipeline_stages_used': [], 'processing_notes': {}}, 'ONEPETRO': {'name': 'ONEPETRO', 'display_name': 'Onepetro', 'type': 'source_of_record', 'status': 'active', 'datasets': {}, 'pipeline_stages_used': [], 'processing_notes': {}}, 'rrc': {'name': 'rrc', 'display_name': 'Rrc', 'type': 'source_of_record', 'status': 'active', 'datasets': {'completions_data': {'name': 'completions_data', 'display_name': 'Completions Data', 'status': 'ready', 'pipeline_stages': {'parsed': {'path': 'parsed/', 'status': 'complete', 'format': 'csv', 'total_files': 29, 'total_rows': 541053, 'total_size_bytes': 72760644, 'total_size_human': '69.4 MB', 'files': [{'file': '260663.csv', 'rows': 1, 'size_bytes': 111, 'format': 'csv'}, {'file': 'g_1.csv', 'rows': 5724, 'size_bytes': 2386013, 'format': 'csv'}, {'file': 'g_10.csv', 'rows': 2449, 'size_bytes': 335831, 'format': 'csv'}, {'file': 'g_1_amount_and_material_data.csv', 'rows': 5603, 'size_bytes': 746987, 'format': 'csv'}, {'file': 'g_1_casing_data.csv', 'rows': 14855, 'size_bytes': 1773589, 'format': 'csv'}, {'file': 'g_1_field_data.csv', 'rows': 5306, 'size_bytes': 492828, 'format': 'csv'}, {'file': 'g_1_formation_data.csv', 'rows': 54960, 'size_bytes': 6294632, 'format': 'csv'}, {'file': 'g_1_liner_data.csv', 'rows': 1120, 'size_bytes': 126995, 'format': 'csv'}, {'file': 'g_1_measurement_data.csv', 'rows': 2787, 'size_bytes': 383880, 'format': 'csv'}, {'file': 'g_1_multi_completion_data.csv', 'rows': 26, 'size_bytes': 3214, 'format': 'csv'}, {'file': 'g_1_production_interval_data.csv', 'rows': 7145, 'size_bytes': 729173, 'format': 'csv'}, {'file': 'g_1_tubing_data.csv', 'rows': 3916, 'size_bytes': 357987, 'format': 'csv'}, {'file': 'g_5.csv', 'rows': 2394, 'size_bytes': 466406, 'format': 'csv'}, {'file': 'l_1.csv', 'rows': 11102, 'size_bytes': 931750, 'format': 'csv'}, {'file': 'packet.csv', 'rows': 25106, 'size_bytes': 7597215, 'format': 'csv'}, {'file': 'packet_workover.csv', 'rows': 2005, 'size_bytes': 232671, 'format': 'csv'}, {'file': 'p_15.csv', 'rows': 237, 'size_bytes': 16090, 'format': 'csv'}, {'file': 'p_4.csv', 'rows': 9276, 'size_bytes': 788102, 'format': 'csv'}, {'file': 'p_4_gas_gatherer_data.csv', 'rows': 11677, 'size_bytes': 1606822, 'format': 'csv'}, {'file': 'p_4_oil_gatherer_data.csv', 'rows': 11623, 'size_bytes': 1483032, 'format': 'csv'}, {'file': 'w_12.csv', 'rows': 1146, 'size_bytes': 110986, 'format': 'csv'}, {'file': 'w_2.csv', 'rows': 19382, 'size_bytes': 7433386, 'format': 'csv'}, {'file': 'w_2_amount_and_material_data.csv', 'rows': 15974, 'size_bytes': 2098737, 'format': 'csv'}, {'file': 'w_2_casing_data.csv', 'rows': 54647, 'size_bytes': 6447239, 'format': 'csv'}, {'file': 'w_2_formation_data.csv', 'rows': 233272, 'size_bytes': 26052104, 'format': 'csv'}, {'file': 'w_2_liner_data.csv', 'rows': 4273, 'size_bytes': 480759, 'format': 'csv'}, {'file': 'w_2_multi_completion_data.csv', 'rows': 103, 'size_bytes': 12314, 'format': 'csv'}, {'file': 'w_2_production_interval_data.csv', 'rows': 19567, 'size_bytes': 1975737, 'format': 'csv'}, {'file': 'w_2_tubing_data.csv', 'rows': 15377, 'size_bytes': 1396054, 'format': 'csv'}], 'last_updated': '2025-10-25T14:30:39.550237'}, 'downloads': {'status': 'complete', 'path': 'C:\\Users\\irina\\apex-eor-platform\\data\\raw\\rrc\\completions_data\\downloads', 'timestamp': '2025-10-24T08:20:09.277086', 'files': 2, 'size_bytes': 26897517, 'size_human': '25.65 MB'}, 'extracted': {'status': 'complete', 'path': 'C:\\Users\\irina\\apex-eor-platform\\data\\raw\\rrc\\completions_data\\extracted', 'timestamp': '2025-10-24T11:18:11.739411', 'files': 25356, 'size_bytes': 83692654, 'size_human': '79.82 MB'}}, 'metadata': {'dataset': 'completions_data', 'description': 'Completion packet data organized by submission date and district', 'source': {'url': 'https://mft.rrc.texas.gov/link/ed7ab066-879f-40b6-8144-2ae4b6810c04', 'provider': 'Texas Railroad Commission', 'license': 'Public Domain'}, 'provenance': {'download_timestamp': '2025-10-20T08:15:46.000628', 'downloaded_by': 'automated_script', 'download_method': 'RRC MFT link'}, 'files': {'downloads': {'path': 'downloads/', 'files': {'archive': {'filename': 'documents_20251020 (4).zip', 'size_bytes': 27262976, 'size_human': '26MB', 'checksum_md5': '8e8818f5faa5eecd1ec291295926727a', 'format': 'ZIP archive containing date-based sub-archives'}, 'documentation': {'filename': 'cmpldatasubscriptions_usermanual_20171101.pdf', 'description': 'User manual for completion data subscriptions'}}}, 'extracted': {'path': 'extracted/', 'description': 'Unzipped .dat files in delimited format (NOT YET PARSED)', 'structure': 'date (MM-DD-YYYY) / district / trackingNo_XXXXX / packetData files', 'structure_note': 'Nested folder hierarchy has no analytical value - all metadata is inside .dat files', 'date_range': {'start': '2021-01-02', 'end': '2025-present'}, 'total_packets': 25106, 'total_files': 25106, 'total_folders': 25106, 'size_bytes': 115343360, 'size_human': '110MB', 'file_pattern': 'packetData_{tracking_number}_{status}.dat', 'file_format': {'type': 'ASCII delimited', 'delimiter': '{', 'record_types': ['PACKET (header)', 'PACKET_WORKOVER', 'G-1 (gas well completion)', 'G-1 Measurement Data', 'G-1 Field Data', 'W-2 (oil well completion)', 'W-2 Amount And Material Data', 'P-4 (certificate of compliance)', 'P-15 (productivity statement)', 'G-5 (gas classification)', 'G-10 (gas status)', 'W-12 (inclination report)', 'L-1 (electric log)', 'Casing Data', 'Liner Data', 'Tubing Data', 'Production Interval Data', 'Formation Data', 'Multiple Completion Data']}, 'parsing_needed': True, 'parsing_notes': ['Files are NOT CSV - they use { delimiter', 'Multiple record types per file (hierarchical data)', 'One file per completion packet (small files ~26 lines each)', 'Nested folder structure should be flattened during parsing', 'Date/district/tracking_no should become columns, not folders']}, 'parsed': {'path': 'parsed/', 'status': 'not_created', 'description': 'Will contain flattened, structured data ready for analysis', 'recommended_structure': {'option_1_relational': {'description': 'Separate CSV/parquet files per table type', 'files': ['packets.csv - All PACKET records (25,106 rows)', 'g1_forms.csv - All G-1 gas well completions', 'w2_forms.csv - All W-2 oil well completions', 'p4_forms.csv - All P-4 certificates', 'casing_data.csv - All casing records (child of G-1/W-2)', 'formation_data.csv - All formation records', 'production_intervals.csv - All perforation intervals', 'tubing_data.csv - All tubing records', 'liner_data.csv - All liner records'], 'benefits': ['Mimics relational database structure', 'Easy to query specific form types', 'Efficient for joins on tracking_no/packet_id', 'Can load directly into database']}, 'option_2_single_file': {'description': 'Single denormalized file with all data', 'files': ['completions_all.csv - All records with record_type column'], 'benefits': ['Simple single file', 'Good for exploratory analysis', 'Easy to filter by record type'], 'drawbacks': ['Wide table with many nullable columns', 'Redundant data (packet info repeated)']}, 'option_3_database': {'description': 'Load directly into SQLite/PostgreSQL/DuckDB', 'approach': 'Parse and load in one step, create proper schema with foreign keys', 'benefits': ['Proper relationships enforced', 'Efficient querying', 'No intermediate files needed']}}, 'parsing_strategy': ['1. Read each .dat file', '2. Split on { delimiter', '3. First field identifies record type (PACKET, G-1, W-2, etc.)', '4. Parse according to data dictionary for that record type', '5. Accumulate records by type across all 25,106 files', '6. Output flattened tables (eliminate folder hierarchy)']}}, 'format': {'type': 'Nested ZIP archives √¢‚Ä†‚Äô Delimited text files', 'encoding': 'UTF-8', 'delimiter': '{', 'structure': 'Each packet contains completion form data submitted to RRC'}, 'processing_state': {'download': 'complete', 'extraction': 'complete', 'parsing': 'complete', 'parsing_date': '2025-10-25T14:30:39.550237', 'validation': 'not_started', 'loading': 'not_started', 'extraction_date': '2025-10-24T11:18:11.989787', 'parsed_files': 29}, 'processing_notes': {'extraction': 'Files unzipped but still in raw delimited format - NOT ready for analysis', 'parsing': 'Converted 25,106 .dat files into 28 CSV tables with 541,052 total records', 'validation': 'Should validate after parsing (check schema, data types, required fields)', 'loading': 'Load into database or create analysis-ready files'}, 'parsing_results': {'total_input_files': 25106, 'total_output_files': 28, 'total_records': 541052, 'output_size_bytes': 73400320, 'output_size_human': '70MB', 'summary_file': 'parsed/_parsing_summary.txt', 'key_tables': {'packet': {'rows': 25106, 'size_mb': 7.2}, 'w_2': {'rows': 19382, 'size_mb': 7.1}, 'g_1': {'rows': 5724, 'size_mb': 2.3}, 'w_2_formation_data': {'rows': 233272, 'size_mb': 24.8}, 'g_1_formation_data': {'rows': 54960, 'size_mb': 6.0}}}, 'data_quality': {'completeness': 'unknown', 'validation_date': None, 'known_issues': ['Nested folder structure inefficient (25,106 folders for 25,106 files)', 'Delimited format requires parsing before use', 'Mixed record types in single files (hierarchical data)']}, 'data_dictionaries': ['../metadata/data_dictionaries/completions_packet.json', '../metadata/data_dictionaries/completions_g1.json', '../metadata/data_dictionaries/completions_w2.json'], 'related_datasets': ['horizontal_drilling_permits', 'production'], 'usage_notes': ['DO NOT use extracted/ folder directly for analysis - files are not parsed', 'Parse extracted/ files into structured format first', 'Flatten folder hierarchy during parsing - date/district should be columns', 'Use tracking_no and packet_id as primary keys for linking records', 'Each .dat file contains multiple related records (parent-child relationships)'], 'parsed': {'path': 'parsed/', 'status': 'complete', 'format': 'csv', 'total_files': 29, 'total_rows': 541053, 'total_size_bytes': 72760644, 'total_size_human': '69.4 MB', 'files': [{'file': '260663.csv', 'rows': 1, 'size_bytes': 111, 'format': 'csv'}, {'file': 'g_1.csv', 'rows': 5724, 'size_bytes': 2386013, 'format': 'csv'}, {'file': 'g_10.csv', 'rows': 2449, 'size_bytes': 335831, 'format': 'csv'}, {'file': 'g_1_amount_and_material_data.csv', 'rows': 5603, 'size_bytes': 746987, 'format': 'csv'}, {'file': 'g_1_casing_data.csv', 'rows': 14855, 'size_bytes': 1773589, 'format': 'csv'}, {'file': 'g_1_field_data.csv', 'rows': 5306, 'size_bytes': 492828, 'format': 'csv'}, {'file': 'g_1_formation_data.csv', 'rows': 54960, 'size_bytes': 6294632, 'format': 'csv'}, {'file': 'g_1_liner_data.csv', 'rows': 1120, 'size_bytes': 126995, 'format': 'csv'}, {'file': 'g_1_measurement_data.csv', 'rows': 2787, 'size_bytes': 383880, 'format': 'csv'}, {'file': 'g_1_multi_completion_data.csv', 'rows': 26, 'size_bytes': 3214, 'format': 'csv'}, {'file': 'g_1_production_interval_data.csv', 'rows': 7145, 'size_bytes': 729173, 'format': 'csv'}, {'file': 'g_1_tubing_data.csv', 'rows': 3916, 'size_bytes': 357987, 'format': 'csv'}, {'file': 'g_5.csv', 'rows': 2394, 'size_bytes': 466406, 'format': 'csv'}, {'file': 'l_1.csv', 'rows': 11102, 'size_bytes': 931750, 'format': 'csv'}, {'file': 'packet.csv', 'rows': 25106, 'size_bytes': 7597215, 'format': 'csv'}, {'file': 'packet_workover.csv', 'rows': 2005, 'size_bytes': 232671, 'format': 'csv'}, {'file': 'p_15.csv', 'rows': 237, 'size_bytes': 16090, 'format': 'csv'}, {'file': 'p_4.csv', 'rows': 9276, 'size_bytes': 788102, 'format': 'csv'}, {'file': 'p_4_gas_gatherer_data.csv', 'rows': 11677, 'size_bytes': 1606822, 'format': 'csv'}, {'file': 'p_4_oil_gatherer_data.csv', 'rows': 11623, 'size_bytes': 1483032, 'format': 'csv'}, {'file': 'w_12.csv', 'rows': 1146, 'size_bytes': 110986, 'format': 'csv'}, {'file': 'w_2.csv', 'rows': 19382, 'size_bytes': 7433386, 'format': 'csv'}, {'file': 'w_2_amount_and_material_data.csv', 'rows': 15974, 'size_bytes': 2098737, 'format': 'csv'}, {'file': 'w_2_casing_data.csv', 'rows': 54647, 'size_bytes': 6447239, 'format': 'csv'}, {'file': 'w_2_formation_data.csv', 'rows': 233272, 'size_bytes': 26052104, 'format': 'csv'}, {'file': 'w_2_liner_data.csv', 'rows': 4273, 'size_bytes': 480759, 'format': 'csv'}, {'file': 'w_2_multi_completion_data.csv', 'rows': 103, 'size_bytes': 12314, 'format': 'csv'}, {'file': 'w_2_production_interval_data.csv', 'rows': 19567, 'size_bytes': 1975737, 'format': 'csv'}, {'file': 'w_2_tubing_data.csv', 'rows': 15377, 'size_bytes': 1396054, 'format': 'csv'}], 'last_updated': '2025-10-25T14:30:39.550237'}}, 'actions_available': ['view_metadata', 'view', 'download', 're-run'], 'metadata_file': 'C:\\Users\\irina\\apex-eor-platform\\data\\raw\\rrc\\completions_data\\metadata.json'}, 'horizontal_drilling_permits': {'name': 'horizontal_drilling_permits', 'display_name': 'Horizontal Drilling Permits', 'status': 'ready', 'pipeline_stages': {'parsed': {'path': 'parsed/', 'status': 'complete', 'format': 'csv', 'total_files': 1, 'total_rows': 168239, 'total_size_bytes': 46713500, 'total_size_human': '44.5 MB', 'files': [{'file': 'horizontal_permits.csv', 'rows': 168239, 'size_bytes': 46713500, 'format': 'csv'}], 'last_updated': '2025-10-25T14:30:39.649647'}, 'downloads': {'status': 'complete', 'path': 'C:\\Users\\irina\\apex-eor-platform\\data\\raw\\rrc\\horizontal_drilling_permits\\downloads', 'timestamp': '2025-10-24T08:13:17.251868', 'files': 2, 'size_bytes': 59932652, 'size_human': '57.16 MB'}, 'extracted': {'status': 'empty', 'path': 'C:\\Users\\irina\\apex-eor-platform\\data\\raw\\rrc\\horizontal_drilling_permits\\extracted', 'timestamp': '2025-10-24T08:12:54.099581'}}, 'metadata': {'dataset': 'horizontal_drilling_permits', 'description': 'Horizontal drilling permit applications (DAF318 format)', 'source': {'url': 'https://mft.rrc.texas.gov/link/c725637f-6748-47b9-ad74-e0396879d88b', 'provider': 'Texas Railroad Commission', 'license': 'Public Domain', 'update_frequency': 'Weekly'}, 'provenance': {'download_timestamp': '2025-10-20T08:15:44.526835', 'downloaded_by': 'automated_script', 'download_method': 'RRC MFT link'}, 'files': {'downloads': {'path': 'downloads/', 'files': {'raw_file': {'filename': 'daf318', 'size_bytes': 60817408, 'size_human': '58MB', 'checksum_md5': '9d9a48fd11cdabea5866c6291e542af2', 'format': 'Fixed-width text file', 'record_length': 360, 'record_count': 'unknown'}, 'documentation': {'filename': 'documentation.pdf', 'description': 'DAF318 field specifications and format documentation'}}}, 'parsed': {'path': 'parsed/', 'status': 'complete', 'description': 'Fixed-width data parsed into CSV with proper field names', 'files': {'horizontal_permits.csv': {'size_bytes': 46661632, 'size_human': '44.5MB', 'row_count': 168239, 'column_count': 37}}}}, 'format': {'type': 'Fixed-width', 'encoding': 'ASCII', 'record_length': 360, 'line_terminator': 'CRLF', 'data_dictionary': '../metadata/data_dictionaries/daf318.json'}, 'processing_state': {'download': 'complete', 'extraction': 'not_applicable', 'parsing': 'complete', 'parsing_date': '2025-10-25T14:30:39.649647', 'validation': 'not_started', 'loading': 'not_started', 'parsed_files': 1}, 'parsing_results': {'total_records': 168239, 'records_parsed': 168239, 'records_skipped': 0, 'output_file': 'parsed/horizontal_permits.csv', 'output_size_mb': 44.5, 'fields_extracted': 37, 'summary_file': 'parsed/horizontal_permits_summary.txt'}, 'data_quality': {'completeness': 'unknown', 'validation_date': None, 'known_issues': []}, 'schema': {'total_fields': 79, 'key_fields': ['API_WELL_NUMBER', 'LEASE_NAME', 'OPERATOR_NAME', 'OPERATOR_NUMBER', 'DISTRICT_NUMBER', 'FIELD_NUMBER'], 'date_fields': ['APPLICATION_DATE', 'APPROVAL_DATE'], 'location_fields': ['COUNTY', 'ABSTRACT', 'SURVEY', 'SECTION', 'BLOCK']}, 'related_datasets': ['completions_data', 'production'], 'notes': ['DAF318 is a fixed-width format requiring parsing before analysis', 'Contains horizontal drilling permit applications only', 'API numbers can be linked to production and completion data', 'Field specifications documented in data dictionary'], 'parsed': {'path': 'parsed/', 'status': 'complete', 'format': 'csv', 'total_files': 1, 'total_rows': 168239, 'total_size_bytes': 46713500, 'total_size_human': '44.5 MB', 'files': [{'file': 'horizontal_permits.csv', 'rows': 168239, 'size_bytes': 46713500, 'format': 'csv'}], 'last_updated': '2025-10-25T14:30:39.649647'}}, 'actions_available': ['view_metadata', 'view', 'download', 're-run'], 'metadata_file': 'C:\\Users\\irina\\apex-eor-platform\\data\\raw\\rrc\\horizontal_drilling_permits\\metadata.json'}, 'production': {'name': 'production', 'display_name': 'Production', 'status': 'ready', 'pipeline_stages': {'parsed': {'path': 'parsed/', 'status': 'complete', 'format': 'csv', 'total_files': 16, 'total_rows': 216079924, 'total_size_bytes': 35694822955, 'total_size_human': '33.24 GB', 'files': [{'file': 'GP_COUNTY_DATA_TABLE.csv', 'rows': 277, 'size_bytes': 7601, 'format': 'csv'}, {'file': 'GP_DATE_RANGE_CYCLE_DATA_TABLE.csv', 'rows': 1, 'size_bytes': 165, 'format': 'csv'}, {'file': 'GP_DISTRICT_DATA_TABLE.csv', 'rows': 14, 'size_bytes': 448, 'format': 'csv'}, {'file': 'OG_COUNTY_CYCLE_DATA_TABLE.csv', 'rows': 237837, 'size_bytes': 14744184, 'format': 'csv'}, {'file': 'OG_COUNTY_LEASE_CYCLE_DATA_TABLE.csv', 'rows': 74216875, 'size_bytes': 12557914193, 'format': 'csv'}, {'file': 'OG_DISTRICT_CYCLE_DATA_TABLE.csv', 'rows': 5122, 'size_bytes': 266852, 'format': 'csv'}, {'file': 'OG_FIELD_CYCLE_DATA_TABLE.csv', 'rows': 10955152, 'size_bytes': 696914680, 'format': 'csv'}, {'file': 'OG_FIELD_DW_DATA_TABLE.csv', 'rows': 65819, 'size_bytes': 7969203, 'format': 'csv'}, {'file': 'OG_LEASE_CYCLE_DATA_TABLE.csv', 'rows': 76217324, 'size_bytes': 12670402979, 'format': 'csv'}, {'file': 'OG_LEASE_CYCLE_DISP_DATA_TABLE.csv', 'rows': 47112409, 'size_bytes': 9184015834, 'format': 'csv'}, {'file': 'OG_OPERATOR_CYCLE_DATA_TABLE.csv', 'rows': 3638489, 'size_bytes': 204895582, 'format': 'csv'}, {'file': 'OG_OPERATOR_DW_DATA_TABLE.csv', 'rows': 77637, 'size_bytes': 6949657, 'format': 'csv'}, {'file': 'OG_REGULATORY_LEASE_DW_DATA_TABLE.csv', 'rows': 543846, 'size_bytes': 54204887, 'format': 'csv'}, {'file': 'OG_SUMMARY_MASTER_LARGE_DATA_TABLE.csv', 'rows': 1101900, 'size_bytes': 120954861, 'format': 'csv'}, {'file': 'OG_SUMMARY_ONSHORE_LEASE_DATA_TABLE.csv', 'rows': 1093186, 'size_bytes': 116727967, 'format': 'csv'}, {'file': 'OG_WELL_COMPLETION_DATA_TABLE.csv', 'rows': 814036, 'size_bytes': 58853862, 'format': 'csv'}], 'last_updated': '2025-10-25T14:30:38.936828'}, 'downloads': {'status': 'complete', 'path': 'C:\\Users\\irina\\apex-eor-platform\\data\\raw\\rrc\\production\\downloads', 'timestamp': '2025-10-24T08:09:02.864074', 'files': 2, 'size_bytes': 3627244953, 'size_human': '3.38 GB'}, 'extracted': {'status': 'complete', 'path': 'C:\\Users\\irina\\apex-eor-platform\\data\\raw\\rrc\\production\\extracted', 'timestamp': '2025-10-24T08:09:22.672372', 'files': 16, 'size_bytes': 24156723854, 'size_human': '22.50 GB'}}, 'metadata': {'dataset': 'production', 'description': 'Production Data Query (PDQ) - 16 tables with oil and gas production data from 1993 to current', 'source': {'url': 'https://mft.rrc.texas.gov/link/1f5ddb8d-329a-4459-b7f8-177b4f5ee60d', 'provider': 'Texas Railroad Commission', 'license': 'Public Domain', 'update_frequency': 'Monthly'}, 'provenance': {'download_timestamp': '2025-10-20T08:15:39.353178', 'extraction_timestamp': '2025-09-26T18:18:00', 'downloaded_by': 'automated_script', 'download_method': 'RRC MFT link'}, 'files': {'downloads': {'path': 'downloads/', 'files': {'archive': {'filename': 'PDQ_DSV.zip', 'size_bytes': 3649044480, 'size_human': '3.4GB', 'checksum_md5': 'fe1e7417ee16d28718f6763c8512cc12', 'format': 'ZIP archive containing 16 DSV files'}, 'documentation': {'filename': 'documentation.pdf', 'description': 'PDQ data dictionary and schema documentation', 'pages': 43}}}, 'extracted': {'path': 'extracted/', 'size_bytes': 35433480192, 'size_human': '33GB', 'file_count': 16, 'file_pattern': '*_DATA_TABLE.dsv'}}, 'format': {'type': 'DSV (Delimiter-Separated Values)', 'delimiter': '}', 'encoding': 'UTF-8', 'null_representation': 'empty string or specific codes'}, 'processing_state': {'download': 'complete', 'extraction': 'complete', 'parsing': 'complete', 'parsing_date': '2025-10-25T14:30:38.936828', 'validation': 'not_started', 'loading': 'not_started', 'parsed_files': 16, 'total_files': 32, 'extraction_date': '2025-10-24T11:18:11.739411'}, 'parsed': {'path': 'parsed/', 'status': 'complete', 'format': 'csv', 'total_files': 16, 'total_rows': 216079924, 'total_size_bytes': 35694822955, 'total_size_human': '33.24 GB', 'files': [{'file': 'GP_COUNTY_DATA_TABLE.csv', 'rows': 277, 'size_bytes': 7601, 'format': 'csv'}, {'file': 'GP_DATE_RANGE_CYCLE_DATA_TABLE.csv', 'rows': 1, 'size_bytes': 165, 'format': 'csv'}, {'file': 'GP_DISTRICT_DATA_TABLE.csv', 'rows': 14, 'size_bytes': 448, 'format': 'csv'}, {'file': 'OG_COUNTY_CYCLE_DATA_TABLE.csv', 'rows': 237837, 'size_bytes': 14744184, 'format': 'csv'}, {'file': 'OG_COUNTY_LEASE_CYCLE_DATA_TABLE.csv', 'rows': 74216875, 'size_bytes': 12557914193, 'format': 'csv'}, {'file': 'OG_DISTRICT_CYCLE_DATA_TABLE.csv', 'rows': 5122, 'size_bytes': 266852, 'format': 'csv'}, {'file': 'OG_FIELD_CYCLE_DATA_TABLE.csv', 'rows': 10955152, 'size_bytes': 696914680, 'format': 'csv'}, {'file': 'OG_FIELD_DW_DATA_TABLE.csv', 'rows': 65819, 'size_bytes': 7969203, 'format': 'csv'}, {'file': 'OG_LEASE_CYCLE_DATA_TABLE.csv', 'rows': 76217324, 'size_bytes': 12670402979, 'format': 'csv'}, {'file': 'OG_LEASE_CYCLE_DISP_DATA_TABLE.csv', 'rows': 47112409, 'size_bytes': 9184015834, 'format': 'csv'}, {'file': 'OG_OPERATOR_CYCLE_DATA_TABLE.csv', 'rows': 3638489, 'size_bytes': 204895582, 'format': 'csv'}, {'file': 'OG_OPERATOR_DW_DATA_TABLE.csv', 'rows': 77637, 'size_bytes': 6949657, 'format': 'csv'}, {'file': 'OG_REGULATORY_LEASE_DW_DATA_TABLE.csv', 'rows': 543846, 'size_bytes': 54204887, 'format': 'csv'}, {'file': 'OG_SUMMARY_MASTER_LARGE_DATA_TABLE.csv', 'rows': 1101900, 'size_bytes': 120954861, 'format': 'csv'}, {'file': 'OG_SUMMARY_ONSHORE_LEASE_DATA_TABLE.csv', 'rows': 1093186, 'size_bytes': 116727967, 'format': 'csv'}, {'file': 'OG_WELL_COMPLETION_DATA_TABLE.csv', 'rows': 814036, 'size_bytes': 58853862, 'format': 'csv'}], 'last_updated': '2025-10-25T14:30:38.936828'}, 'data_quality': {'completeness': 'unknown', 'validation_date': None, 'known_issues': []}, 'tables': {'OG_LEASE_CYCLE': {'file': 'OG_LEASE_CYCLE_DATA_TABLE.dsv', 'description': 'Production by lease and month', 'primary_key': ['OIL_GAS_CODE', 'DISTRICT_NO', 'LEASE_NO', 'CYCLE_YEAR', 'CYCLE_MONTH'], 'data_dictionary': '../metadata/data_dictionaries/og_lease_cycle.json', 'row_count': 'unknown', 'critical_for_eor': True}, 'OG_LEASE_CYCLE_DISP': {'file': 'OG_LEASE_CYCLE_DISP_DATA_TABLE.dsv', 'description': 'Disposition details by lease and month (critical for EOR - code 06)', 'primary_key': ['OIL_GAS_CODE', 'DISTRICT_NO', 'LEASE_NO', 'CYCLE_YEAR', 'CYCLE_MONTH'], 'data_dictionary': '../metadata/data_dictionaries/og_lease_cycle_disp.json', 'row_count': 'unknown', 'critical_for_eor': True}, 'OG_WELL_COMPLETION': {'file': 'OG_WELL_COMPLETION_DATA_TABLE.dsv', 'description': 'Well identification and completion data with API numbers', 'primary_key': ['API_NO'], 'data_dictionary': '../metadata/data_dictionaries/og_well_completion.json', 'row_count': 'unknown', 'critical_for_eor': True}, 'OG_FIELD_DW': {'file': 'OG_FIELD_DW_DATA_TABLE.dsv', 'description': 'Field master data (dimension table)', 'primary_key': ['OIL_GAS_CODE', 'DISTRICT_NO', 'FIELD_NO'], 'data_dictionary': '../metadata/data_dictionaries/og_field_dw.json', 'row_count': 'unknown', 'critical_for_eor': False}, 'OG_OPERATOR_DW': {'file': 'OG_OPERATOR_DW_DATA_TABLE.dsv', 'description': 'Operator master data (dimension table)', 'primary_key': ['OPER_NO'], 'data_dictionary': '../metadata/data_dictionaries/og_operator_dw.json', 'row_count': 'unknown', 'critical_for_eor': False}, 'OG_REGULATORY_LEASE_DW': {'file': 'OG_REGULATORY_LEASE_DW_DATA_TABLE.dsv', 'description': 'Lease master data linking operators, fields, and wells', 'primary_key': ['OIL_GAS_CODE', 'DISTRICT_NO', 'LEASE_NO'], 'data_dictionary': '../metadata/data_dictionaries/og_regulatory_lease_dw.json', 'row_count': 'unknown', 'critical_for_eor': True}, 'OG_COUNTY_CYCLE': {'file': 'OG_COUNTY_CYCLE_DATA_TABLE.dsv', 'description': 'Production aggregated by county', 'row_count': 'unknown', 'critical_for_eor': False}, 'OG_COUNTY_LEASE_CYCLE': {'file': 'OG_COUNTY_LEASE_CYCLE_DATA_TABLE.dsv', 'description': 'Production by county and lease', 'row_count': 'unknown', 'critical_for_eor': False}, 'OG_DISTRICT_CYCLE': {'file': 'OG_DISTRICT_CYCLE_DATA_TABLE.dsv', 'description': 'Production aggregated by district', 'row_count': 'unknown', 'critical_for_eor': False}, 'OG_FIELD_CYCLE': {'file': 'OG_FIELD_CYCLE_DATA_TABLE.dsv', 'description': 'Production aggregated by field', 'row_count': 'unknown', 'critical_for_eor': False}, 'OG_OPERATOR_CYCLE': {'file': 'OG_OPERATOR_CYCLE_DATA_TABLE.dsv', 'description': 'Production aggregated by operator', 'row_count': 'unknown', 'critical_for_eor': False}, 'OG_SUMMARY_MASTER_LARGE': {'file': 'OG_SUMMARY_MASTER_LARGE_DATA_TABLE.dsv', 'description': 'Summary table for operator-level queries', 'row_count': 'unknown', 'critical_for_eor': False}, 'OG_SUMMARY_ONSHORE_LEASE': {'file': 'OG_SUMMARY_ONSHORE_LEASE_DATA_TABLE.dsv', 'description': 'Summary table for onshore county leases', 'row_count': 'unknown', 'critical_for_eor': False}, 'GP_COUNTY': {'file': 'GP_COUNTY_DATA_TABLE.dsv', 'description': 'County reference data', 'row_count': 'unknown', 'critical_for_eor': False}, 'GP_DISTRICT': {'file': 'GP_DISTRICT_DATA_TABLE.dsv', 'description': 'District reference data', 'row_count': 'unknown', 'critical_for_eor': False}, 'GP_DATE_RANGE_CYCLE': {'file': 'GP_DATE_RANGE_CYCLE_DATA_TABLE.dsv', 'description': 'Date range metadata for cycles', 'row_count': 'unknown', 'critical_for_eor': False}}, 'related_datasets': [], 'eor_analysis_notes': ['OG_LEASE_CYCLE_DISP: Look for disposition code 06 (repressure/pressure maintenance)', 'OG_LEASE_CYCLE: Production volumes needed to calculate injection vs production ratios', 'OG_WELL_COMPLETION: API numbers link wells to production data', 'OG_REGULATORY_LEASE_DW: Links operators to leases for ownership tracking']}, 'actions_available': ['view_metadata', 'view', 'download', 're-run'], 'metadata_file': 'C:\\Users\\irina\\apex-eor-platform\\data\\raw\\rrc\\production\\metadata.json'}}, 'pipeline_stages_used': ['downloads', 'extracted', 'parsed'], 'processing_notes': {}}, 'TWDB': {'name': 'TWDB', 'display_name': 'Twdb', 'type': 'source_of_record', 'status': 'active', 'datasets': {}, 'pipeline_stages_used': [], 'processing_notes': {}}, 'usgs': {'name': 'usgs', 'display_name': 'Usgs', 'type': 'source_of_record', 'status': 'active', 'datasets': {'produced_water': {'name': 'produced_water', 'display_name': 'Produced Water', 'status': 'unknown', 'pipeline_stages': {'downloads': {'status': 'empty', 'path': 'C:\\Users\\irina\\apex-eor-platform\\data\\raw\\usgs\\produced_water\\downloads', 'timestamp': '2025-10-26T05:34:35.096186'}}, 'metadata': {}, 'actions_available': [], 'metadata_file': None}}, 'pipeline_stages_used': [], 'processing_notes': {}}}}

def create_dashboard():
    with gr.Blocks(theme=gr.themes.Soft(), css=get_m3_theme_css()) as demo:
        # Beautiful gradient header
        gr.HTML("""
        <div class="md-header-gradient md-fade-in">
            <h1 class="md-header-title">üìä Data Pipeline Navigator</h1>
            <p class="md-header-subtitle">Navigate your hierarchical data sources with ease</p>
        </div>
        """)

        with gr.Row():
            # Left sidebar: Quick stats cards
            with gr.Column(scale=1, min_width=250):
                gr.HTML("""
                <div class="md-slide-in">
                    <div style="margin-bottom: 16px;">
                        <div class="md-card md-status-card md-status-card-success">
                            <div style="font-size: 32px; font-weight: 300; color: var(--md-success);">{{total_sources}}</div>
                            <div style="font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; color: var(--md-on-surface-variant);">Data Sources</div>
                        </div>
                    </div>
                    <div style="margin-bottom: 16px;">
                        <div class="md-card md-status-card md-status-card-info">
                            <div style="font-size: 32px; font-weight: 300; color: var(--md-info);">{{total_datasets}}</div>
                            <div style="font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; color: var(--md-on-surface-variant);">Datasets</div>
                        </div>
                    </div>
                    <div>
                        <div class="md-card md-status-card md-status-card-warning">
                            <div style="font-size: 32px; font-weight: 300; color: var(--md-warning);">{{processing_count}}</div>
                            <div style="font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; color: var(--md-on-surface-variant);">Processing</div>
                        </div>
                    </div>
                </div>
                """.replace('{{total_sources}}', str(len(PIPELINE_DATA.get("sources", {})))).replace('{{total_datasets}}', '12').replace('{{processing_count}}', '2'))

            # Main content: Navigation dropdowns
            with gr.Column(scale=2):
                gr.Markdown("### üîç Navigate Hierarchy", elem_classes=["m3-title-large"])

                with gr.Row():
                    source_dropdown = gr.Dropdown(
                        choices=list(PIPELINE_DATA["sources"].keys()),
                        label="üìÅ Source",
                        value=list(PIPELINE_DATA["sources"].keys())[0] if PIPELINE_DATA["sources"] else None,
                        interactive=True,
                        elem_classes=["md-fade-in"]
                    )
                    dataset_dropdown = gr.Dropdown(
                        choices=[],
                        label="üìä Dataset",
                        interactive=True,
                        elem_classes=["md-fade-in"]
                    )
                    stage_dropdown = gr.Dropdown(
                        choices=[],
                        label="‚öôÔ∏è Stage",
                        interactive=True,
                        elem_classes=["md-fade-in"]
                    )

                # Breadcrumb path display
                gr.HTML("""
                <div class="md-card md-card-filled" style="margin: 16px 0;">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 14px; color: var(--md-on-surface-variant); font-weight: 500;">üìç Current Path:</span>
                        <span id="breadcrumb-path" style="font-size: 14px; color: var(--md-primary); font-weight: 600;">Home</span>
                    </div>
                </div>
                """)

                current_path = gr.Textbox(
                    label="Current Path",
                    value="",
                    interactive=False,
                    visible=False
                )

                with gr.Row():
                    refresh_btn = gr.Button(
                        "üîÑ Refresh",
                        size="sm",
                        variant="secondary",
                        elem_classes=["md-button-outlined"]
                    )

                # File listing with M3 styling
                gr.Markdown("### üìÑ Files", elem_classes=["m3-title-medium"])
                files_df = gr.Dataframe(
                    headers=["Name", "Type", "Size", "Modified"],
                    value=[],
                    interactive=False,
                    wrap=True,
                    label="Files in Stage",
                    elem_classes=["md-data-table", "md-fade-in"]
                )

                # File selection info
                selected_file = gr.Textbox(
                    label="Selected File",
                    value="",
                    interactive=False,
                    visible=False
                )

        # Event handlers
        def update_datasets(source_name):
            if not source_name or source_name not in PIPELINE_DATA["sources"]:
                return gr.Dropdown(choices=[]), gr.Dropdown(choices=[]), "", []
            datasets = list(PIPELINE_DATA["sources"][source_name].get("datasets", {}).keys())
            path = f"{{source_name}}"
            return (
                gr.Dropdown(choices=datasets, value=datasets[0] if datasets else None),
                gr.Dropdown(choices=[]),
                path,
                []
            )

        def update_stages(source_name, dataset_name):
            if not source_name or not dataset_name:
                return gr.Dropdown(choices=[]), "", []
            stages = ["downloads", "extracted", "parsed"]
            path = f"{{source_name}} / {{dataset_name}}"
            return (
                gr.Dropdown(choices=stages, value=stages[0] if stages else None),
                path,
                []
            )

        def update_files(source_name, dataset_name, stage_name):
            if not source_name or not dataset_name or not stage_name:
                return "", []
            path = f"{{source_name}} / {{dataset_name}} / {{stage_name}}"
            # Beautiful file listing
            files = [
                ["üìÑ file1.csv", "CSV", "1.2 MB", "2025-01-15"],
                ["üìÑ file2.json", "JSON", "856 KB", "2025-01-15"],
                ["üìÑ file3.parquet", "Parquet", "2.4 MB", "2025-01-14"],
                ["üìÑ data.xlsx", "Excel", "3.1 MB", "2025-01-15"],
                ["üìÑ metadata.yaml", "YAML", "12 KB", "2025-01-14"]
            ]
            return path, files

        # Wire events
        source_dropdown.change(
            update_datasets,
            [source_dropdown],
            [dataset_dropdown, stage_dropdown, current_path, files_df]
        )
        dataset_dropdown.change(
            update_stages,
            [source_dropdown, dataset_dropdown],
            [stage_dropdown, current_path, files_df]
        )
        stage_dropdown.change(
            update_files,
            [source_dropdown, dataset_dropdown, stage_dropdown],
            [current_path, files_df]
        )

        # Auto-load on launch
        demo.load(
            update_datasets,
            [source_dropdown],
            [dataset_dropdown, stage_dropdown, current_path, files_df]
        )

    return demo

if __name__ == "__main__":
    demo = create_dashboard()
    demo.launch()
